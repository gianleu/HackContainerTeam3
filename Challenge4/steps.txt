RESOURCE_GROUP=MC_teamResources_aksohteam3_northeurope
SUBID=2009f869-247e-4bfb-ab22-d55b89f1e2ec
clientId=214002bd-a2b7-4c88-ab96-f509b25365ea
identityName=adidentitykv
resourceGroupName=teamResources

az role assignment create --role "Managed Identity Operator" --assignee $clientId --scope /subscriptions/$SUBID/resourcegroups/$RESOURCE_GROUP

az role assignment create --role "Virtual Machine Contributor" --assignee $clientId --scope /subscriptions/$SUBID/resourcegroups/$RESOURCE_GROUP

az identity create -g $resourceGroupName -n $identityName


{
  "clientId": "d985a768-60fd-4fff-8a61-1d7e13a33309",
  "clientSecretUrl": "https://control-northeurope.identity.azure.net/subscriptions/2009f869-247e-4bfb-ab22-d55b89f1e2ec/resourcegroups/teamResources/providers/Microsoft.ManagedIdentity/userAssignedIdentities/adidentitykv/credentials?tid=af2e7cb2-62cc-471a-951a-f1c6a6c9527a&oid=28a452e4-89f4-4e1a-aff2-749171e8a37d&aid=d985a768-60fd-4fff-8a61-1d7e13a33309",
  "id": "/subscriptions/2009f869-247e-4bfb-ab22-d55b89f1e2ec/resourcegroups/teamResources/providers/Microsoft.ManagedIdentity/userAssignedIdentities/adidentitykv",
  "location": "northeurope",
  "name": "adidentitykv",
  "principalId": "28a452e4-89f4-4e1a-aff2-749171e8a37d",
  "resourceGroup": "teamResources",
  "tags": {},
  "tenantId": "af2e7cb2-62cc-471a-951a-f1c6a6c9527a",
  "type": "Microsoft.ManagedIdentity/userAssignedIdentities"
}

principalId=28a452e4-89f4-4e1a-aff2-749171e8a37d
clientId=d985a768-60fd-4fff-8a61-1d7e13a33309

az role assignment create --role "Reader" --assignee $principalId --scope /subscriptions/$SUBID/resourceGroups/$resourceGroupName/providers/Microsoft.KeyVault/vaults/Team3hackkv

az keyvault set-policy -n Team3hackkv --secret-permissions get --spn $clientId
az keyvault set-policy -n Team3hackkv --key-permissions get --spn $clientId